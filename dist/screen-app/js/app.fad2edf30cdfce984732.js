webpackJsonp([1],{0:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("7+uW"),i=r("pZOg"),a=r.n(i),s=r("8+8L"),u=(r("7KUr"),r("gBtx")),o=r.n(u),c=r("PJh5"),l=r.n(c),d={name:"Clock",props:{timeFunction:{type:Function}},data:function(){return{time:this.timeFunction()}},methods:{updateTime:function(){this.time=this.timeFunction()}},mounted:function(){setInterval(this.updateTime,1e3)}},h={render:function(){var e=this.$createElement;return(this._self._c||e)("span",[this._v(this._s(this.time.format("dddd, MMMM Do YYYY - h:mm:ss a")))])},staticRenderFns:[]};function m(e){return e&&e.format("YYYY-MM-DD")}function f(e){return e&&e.format("HH:mm:ss")}var p={name:"DebugTimeInput",props:{scheduler:{}},data:function(){return{debugDate:m(this.scheduler.debugTime),debugTime:f(this.scheduler.debugTime)}},methods:{setDebugTime:function(){var e=this.debugDate||m(l()()),t=this.debugTime||f(l()());this.scheduler.setDebugTime(l()(e+" "+t))},clearDebugTime:function(){this.scheduler.clearDebugTime()}}},v={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",[r("input",{directives:[{name:"model",rawName:"v-model",value:e.debugDate,expression:"debugDate"}],attrs:{id:"date",type:"date"},domProps:{value:e.debugDate},on:{input:function(t){t.target.composing||(e.debugDate=t.target.value)}}}),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.debugTime,expression:"debugTime"}],attrs:{id:"time",type:"time",step:"1"},domProps:{value:e.debugTime},on:{input:function(t){t.target.composing||(e.debugTime=t.target.value)}}}),e._v(" "),r("input",{attrs:{type:"button",value:"Set"},on:{click:e.setDebugTime}}),e._v(" "),r("input",{attrs:{type:"button",value:"Clear"},on:{click:e.clearDebugTime}})])},staticRenderFns:[]},g={name:"DebugPane",props:{scheduler:{}},data:function(){return{collapsed:!0,pinned:!1}},components:{Clock:r("VU/8")(d,h,!1,null,null,null).exports,DebugTimeInput:r("VU/8")(p,v,!1,null,null,null).exports},methods:{expand:function(){this.collapsed=!1},collapse:function(){this.pinned||(this.collapsed=!0)},togglePinned:function(){this.pinned=!this.pinned},getScheduleTime:function(){return this.scheduler.getScheduleTime()}}},y={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:{collapsed:e.collapsed,debugPane:!0},on:{mouseover:e.expand,mouseout:e.collapse}},[e.collapsed?e._e():r("div",{staticClass:"contents"},[r("div",[r("b",[e._v("Schedule Time:")]),e._v(" "),r("Clock",{attrs:{timeFunction:e.getScheduleTime}})],1),e._v(" "),r("div",[r("b",[e._v("Debug Time:")]),e._v(" "),r("DebugTimeInput",{attrs:{scheduler:e.scheduler}})],1),e._v(" "),r("div",[r("button",{on:{click:e.togglePinned}},[e._v(e._s(e.pinned?"Unpin":"Pin"))])])])])},staticRenderFns:[]};var T=r("VU/8")(g,y,!1,function(e){r("Qn4P")},"data-v-cc5bf372",null).exports,A={name:"IFramePlayer",props:{source:{type:String}}},b={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("iframe",{staticClass:"player",attrs:{src:this.source}})])},staticRenderFns:[]};var _=r("VU/8")(A,b,!1,function(e){r("eWHW")},"data-v-ed57dcba",null).exports,D=r("Zx67"),P=r.n(D),x=r("Zrlr"),w=r.n(x),E=r("wxAW"),S=r.n(E),k=r("zwoO"),I=r.n(k),U=r("Pf15"),F=r.n(U),L=function(){function e(){w()(this,e),this.listeners={}}return S()(e,[{key:"on",value:function(e,t){if("function"!=typeof t)throw new Error("The 'listener' parameter must be a function");this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}},{key:"off",value:function(e,t){var r=this.listeners,n=r[e];return void 0===t?(r[e]=[],n.length>0):null!=r[e]&&0!==r[e].length&&(r[e]=r[e].filter(function(e){return e!==t}),n.length>r[e].length)}},{key:"fire",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=this.listeners[e];return!(!i||!i.length)&&(i.forEach(function(e){return e.apply(void 0,r)}),!0)}}]),e}(),R=function(e){function t(){var e,r,n,i;w()(this,t);for(var a=arguments.length,s=Array(a),u=0;u<a;u++)s[u]=arguments[u];return r=n=I()(this,(e=t.__proto__||P()(t)).call.apply(e,[this].concat(s))),n.programs=[],n.currentIndex=-1,n.timer=void 0,i=r,I()(n,i)}return F()(t,e),S()(t,[{key:"updatePrograms",value:function(e){var t=this.programs;if(this.programs=e||[],e&&t){var r=t[this.currentIndex],n=e.findIndex(function(e){return e.isEquivalent(r)});if(n>=0&&(this.currentIndex=n,this.timer))return}this.activateProgram()}},{key:"activateProgram",value:function(){var e=this,t=this.programs[this.currentIndex];this.currentIndex=this.programs.length?(this.currentIndex+1)%this.programs.length:-1;var r=this.programs[this.currentIndex];this.timer&&(clearTimeout(this.timer),this.timer=void 0),r&&!r.isEquivalent(t)&&(this.fire("activate",r),this.programs.length>1&&(this.timer=setTimeout(function(){return e.activateProgram()},1e3*r.options.length)))}}]),t}(L),C=r("Xxa5"),B=r.n(C),$=r("gRE1"),M=r.n($),j=r("exGp"),N=r.n(j),O=r("ifoU"),Y=r.n(O),Z=r("woOf"),z=r.n(Z);function H(e,t){return e.hour(t.hour()),e.minute(t.minute()),e.second(t.second()),e.milliseconds(t.milliseconds()),e}function V(e){return e&&0===e.hour()&&0===e.minute()&&0===e.second()}function W(e){return l.a.isMoment(e)?l()(e):null!=e&&""!==e?l()(e,l.a.HTML5_FMT.TIME_SECONDS):void 0}function q(e){return null!=e&&""!==e?l()(e):void 0}function Q(e,t,r,n){if(e&&e.length){var i=r.day(),a=i,s=void 0;"future"===n?(H(l()(r),t).isBefore(r)&&(a=i<6?i+1:0),s=function(e,t){return e.find(function(e){return e>=t})||e[0]}(e,a)-i):(H(l()(r),t).isAfter(r)&&(a=i>0?i-1:6),s=i-function(e,t){return e.slice().reverse().find(function(e){return e<=t})||e[e.length-1]}(e,a)),s<0&&(s+=7);var u=l()(r);return u.add(s,"days"),H(u,t),u}}function J(e){var t,r,n=e&&e.schedule||{};return z()({},e,{schedule:{days:(t=n.days||["sun","mon","tues","wed","thurs","fri","sat"],r=["sun","mon","tues","wed","thurs","fri","sat"],t.map(function(e){var t="string"==typeof e?r.indexOf(e):e;if(-1===t)throw new Error("Unknown day of the week: "+e);return t})),startTime:W(n.startTime||"00:00"),endTime:W(n.endTime||"24:00"),startDateTime:q(n.startDateTime),endDateTime:q(n.endDateTime)}})}var G=function(){function e(t){w()(this,e),this.isEnabled=!0,this.isActive=!1,z()(this,J(t)),this.options&&void 0!==this.options.enabled&&(this.isEnabled=this.options.enabled)}return S()(e,[{key:"configureNextRun",value:function(e){var t=this.schedule,r={startAt:void 0,endAt:void 0,isExpired:!1};if(function(e){return e.days&&7===e.days.length&&V(e.startTime)&&V(e.endTime)}(t))t.startDateTime&&(r.startAt=t.startDateTime),t.endDateTime&&(r.endAt=t.endDateTime,r.isExpired=r.endAt.isBefore(e));else{var n=e,i=!1;t.startTime?(t.startDateTime&&t.startDateTime.isAfter(e)&&(n=t.startDateTime),r.startAt=Q(t.days,t.startTime,n,"future")):(r.startAt=t.startDateTime,i=!0),t.endTime?(r.endAt=Q(t.days,t.endTime,n,"future"),t.endDateTime&&t.endDateTime.isBefore(r.endAt)&&(r.endAt=t.endDateTime)):r.endAt=t.endDateTime,!i&&r.startAt.isAfter(r.endAt)&&(r.startAt=Q(t.days,t.startTime,n,"past")),r.startAt.isSame(r.endAt)&&(r.endAt.add(1,"days"),t.endDateTime&&t.endDateTime.isBefore(r.endAt)&&(r.endAt=t.endDateTime)),r.isExpired=null!=t.endDateTime&&r.startAt.isAfter(t.endDateTime)||r.endAt&&r.endAt.isBefore(e)}this.nextRun=r,this.isActive=this.isEnabled&&(!r.startAt||r.startAt.isSameOrBefore(e))&&(!r.endAt||r.endAt.isAfter(e))}},{key:"isEquivalent",value:function(e){return e&&e.url===this.url&&e.type===this.type}}]),e}();function K(e){return""!==e?e:void 0}function X(e){var t,r,n={type:"iframe",url:e.content&&(r=e.content.guid,r&&r.replace("&#038;","&")).replace(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}/,document.location.origin),priority:e.priority,schedule:{days:e.play_days,startTime:K(e.play_start),endTime:K(e.play_end),startDateTime:K(e.publish_datetime),endDateTime:K(e.unpublish_datetime)},options:{enabled:!0!==e.play_disable,length:(t=e.play_length,null!=t&&""!==t?o()(t,10):void 0),transitions:null}};return e.play_exact&&(n.priority=10),n}function ee(e){var t=[];if(function(e){return null!=e&&null!=e.acf}(e))t=function(e){var t=[];if(!(e&&e.acf&&e.acf.schedule_repeater))throw new Error("Cannot find program data in ACF data");return e.acf.schedule_repeater.forEach(function(e){t.push(X(e))}),t}(e);else{if(!e.programs)throw new Error("No schedule data exists in response from server");t=e.programs}return t}var te,re,ne=(te=N()(B.a.mark(function e(t,r){var i;return B.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a.http.get(t+"kiosign_screens/"+r);case 2:return i=e.sent,e.abrupt("return",i.data);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return te.apply(this,arguments)}),ie=(re=N()(B.a.mark(function e(t){var r;return B.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a.http.get(t);case 2:return r=e.sent,e.abrupt("return",ee(r.data));case 4:case"end":return e.stop()}},e,this)})),function(e){return re.apply(this,arguments)});function ae(e){var t=[],r=0;return e.forEach(function(e){e.priority&&e.priority>r?(t=[e],r=e.priority):0!==r&&e.priority!==r||t.push(e)}),t}var se=function(e){function t(){var e,r,n,i;w()(this,t);for(var a=arguments.length,s=Array(a),u=0;u<a;u++)s[u]=arguments[u];return r=n=I()(this,(e=t.__proto__||P()(t)).call.apply(e,[this].concat(s))),n.debugTime=void 0,n.debugTimeSetAt=void 0,n.serverTime=void 0,n.serverTimeSetAt=void 0,n.programs=[],n.activePrograms=[],n.timers=new Y.a,n.refreshRate=0,i=r,I()(n,i)}return F()(t,e),S()(t,[{key:"setDebugTime",value:function(e){this.debugTime=e,this.debugTimeSetAt=l()(),this.scheduleAll()}},{key:"clearDebugTime",value:function(){this.debugTime=void 0,this.debugTimeSetAt=void 0,this.scheduleAll()}},{key:"setServerTime",value:function(e){this.serverTime=e,this.serverTimeSetAt=l()(),this.scheduleAll()}},{key:"clearServerTime",value:function(){this.serverTime=void 0,this.serverTimeSetAt=void 0,this.scheduleAll()}},{key:"getScheduleTime",value:function(){if(this.debugTime){var e=l()()-this.debugTimeSetAt;return l()(this.debugTime).add(e,"ms")}if(this.serverTime){var t=l()()-this.serverTimeSetAt;return l()(this.serverTime).add(t,"ms")}return l()()}},{key:"load",value:function(){var e=N()(B.a.mark(function e(t){var r,i=this;return B.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.a.$log.debug("Scheduler","Loading program data from",t),e.next=3,ie(t);case 3:r=(r=e.sent).map(function(e){return new G(e)}),n.a.$log.debug("Scheduler","Loaded programs",r),M()(this.timers).forEach(function(e){return clearTimeout(e)}),this.timers=new Y.a,this.programs=r,this.scheduleAll(),this.refreshRate>0&&setTimeout(function(){return i.load(t)},1e3*this.refreshRate);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"scheduleAll",value:function(){var e=this;this.programs.forEach(function(t){return e.schedule(t)}),this.update()}},{key:"schedule",value:function(e){var t=this,r=this.getScheduleTime();if(r.add(1,"s"),e.configureNextRun(r),!e.nextRun.isExpired&&e.isEnabled){var n=e.isActive?e.nextRun.endAt:e.nextRun.startAt,i=n-r;if(n){if(i>2147483647&&(i=2147483647),i<0)throw new Error("Time until next update is less than 0--this should never happen");var a=e.isActive?"programEnded":"programStarted";this.timers[e]=setTimeout(function(){delete t.timers[e],i<2147483647?(t.fire(a,e),t.schedule(e),t.update()):t.schedule(e)},i)}}}},{key:"update",value:function(){this.activePrograms=this.programs.filter(function(e){return e.isActive}),this.fire("update")}}]),t}(L),ue={name:"DefaultLayout",props:{programs:{type:Array}},data:function(){return{activePrograms:void 0,player1Url:"",player2Url:"",player1Active:!0,displayDelay:3e3,rotater:null,timer:null}},methods:{clearIfInactive:function(e){var t=this;this.activePrograms.find(function(r){return r.url===t[e]})||(this[e]=void 0)}},watch:{programs:function(e){var t=this;if(this.activePrograms=ae(e),this.$log.debug("DefaultLayout","Loaded programs",this.activePrograms),!this.rotater){var r=!0;this.rotater=new R,this.rotater.on("activate",function(e){t.$log.debug("DefaultLayout","Loading content from URL",e.url),t.timer&&(clearTimeout(t.timer),t.timer=null),t.player1Active?t.player2Url=e.url:t.player1Url=e.url,t.timer=setTimeout(function(){t.$log.debug("DefaultLayout","Displaying content from URL",e.url),t.player1Active=!t.player1Active,t.timer=null},r?0:t.displayDelay),r=!1})}this.rotater.updatePrograms(this.activePrograms),this.clearIfInactive("player1Url"),this.clearIfInactive("player2Url")}},components:{IFramePlayer:_}},oe={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"layout layout-default"},[e.activePrograms&&0===e.activePrograms.length?r("h1",[e._v("No Programs Are Currently Active")]):e._e(),e._v(" "),r("IFramePlayer",{class:{inactive:!e.player1Active,player:!0},attrs:{source:e.player1Url}}),e._v(" "),r("IFramePlayer",{class:{inactive:e.player1Active,player:!0},attrs:{source:e.player2Url}})],1)},staticRenderFns:[]};var ce=r("VU/8")(ue,oe,!1,function(e){r("fyYS")},"data-v-d34bff90",null).exports,le={name:"SplitLayout",props:{programs:{type:Array}},computed:{activePrograms:{get:function(){return ae(this.programs)}}},components:{IFramePlayer:_}},de={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"layout layout-split"},[this.activePrograms&&0===this.activePrograms.length?t("h1",[this._v("No Programs Are Currently Active")]):this._e(),this._v(" "),this._l(this.activePrograms,function(e,r){return t("div",{key:r},[t("IFramePlayer",{attrs:{source:e.url}})],1)})],2)},staticRenderFns:[]};var he=r("VU/8")(le,de,!1,function(e){r("OC9n")},"data-v-775f9f0f",null).exports,me={name:"App",props:{apiBase:{type:String},screenId:{type:String}},data:function(){return{scheduler:new se,activePrograms:[],layout:"default"}},components:{DebugPane:T,DefaultLayout:ce,SplitLayout:he},mounted:function(){var e=this;ne(this.apiBase,this.screenId).then(function(t){if(!t||!t.acf)throw new Error("Could not load info for screen "+e.screenid);var r=t.acf,n=o()(r.screen_refresh,10),i=r.screen_content&&r.screen_content.ID,a=e.apiBase+"kiosign_schedules/"+i;r.layout&&(e.layout=r.layout),n&&(e.scheduler.refreshRate=60*n,e.$log.debug("App","Scheduler refresh rate: "+n)),r.server_time&&e.scheduler.setServerTime(l()(r.server_time)),e.scheduler.on("update",function(){e.activePrograms=e.scheduler.activePrograms,e.$log.debug("App","updated active programs",e.activePrograms)}),e.scheduler.load(a)})}},fe={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"app"},[t("DebugPane",{attrs:{scheduler:this.scheduler}}),this._v(" "),"split"===this.layout?t("SplitLayout",{attrs:{programs:this.activePrograms}}):t("DefaultLayout",{attrs:{programs:this.activePrograms}})],1)},staticRenderFns:[]};var pe=r("VU/8")(me,fe,!1,function(e){r("hmZ4")},null,null).exports;function ve(e,t){return this.$el.attributes[e].value}n.a.use(a.a,{logLevel:"debug"}),n.a.use(s.a),n.a.config.productionTip=!1,new n.a({el:"#app",components:{App:pe},template:'<App :apiBase="apiBase" :screenId="screenId" />',data:{apiBase:"",screenId:""},beforeMount:function(){this.apiBase=ve.call(this,"data-api-base","/wp-json/acf/v3/"),this.screenId=ve.call(this,"data-screen-id","1")}})},OC9n:function(e,t){},Qn4P:function(e,t){},eWHW:function(e,t){},fyYS:function(e,t){},hmZ4:function(e,t){},tdTh:function(e,t,r){var n={"./en-au":"Sjoy","./en-au.js":"Sjoy","./en-ca":"Tqun","./en-ca.js":"Tqun","./en-gb":"hPuz","./en-gb.js":"hPuz","./en-ie":"ALEw","./en-ie.js":"ALEw","./en-il":"QZk1","./en-il.js":"QZk1","./en-nz":"dyB6","./en-nz.js":"dyB6"};function i(e){return r(a(e))}function a(e){var t=n[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}i.keys=function(){return Object.keys(n)},i.resolve=a,e.exports=i,i.id="tdTh"}},["NHnr"]);
//# sourceMappingURL=app.fad2edf30cdfce984732.js.map